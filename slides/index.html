<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Serverless</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<style>
			.dimmer {
				background: rgba(34,34,34,0.9);
				padding: 30px !important;
				border-radius: 4px;
			}
			.fragment.visible {
				opacity: 0.5 !important;
			}
			.fragment.visible.current-fragment {
				opacity: 1 !important;
			}

			.fragment.visible span {
				transition: color .2s;
				color: white;
			}

			.color1,
			.fragment.visible.current-fragment span.color1 {
				color: #e4af3c;
			}
			.color2,
			.fragment.visible.current-fragment span.color2 {
				color: #3cafe4;
			}
			.color3,
			.fragment.visible.current-fragment span.color3 {
				color: #e43caf;
			}
			.color4,
			.fragment.visible.current-fragment span.color4 {
				color: #3ce4af;
			}

			.hljs {
				background-color: #283238;
				padding: 30px !important;
			}

			.reveal pre {
				background-color: #283238;
				width: 100%;
				font-size: 30px;
				padding: 30px !important;
			}

			.lesser,
			.fragment.visible span {
				color: #777;
			}
		</style>

	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2>Serverless Lessons</h2>
					<p>Running a startup 100% on Serverless</p>
				</section>

				<section>
					<h3>Tal Bereznitskey</h3>
					<p>
						Co-Founder and CTO
					</p>
						<img src="./images/Torii_logo_white.png" height="200" style="margin: 15px;border: none;"/>
						<p class="fragment">SaaS Management Platform</p>
						<p class="fragment">built entirely on serverless</p>
				</section>

				<section>
					<h1>ü§ñ</h1>
					<h2>1 Minute Slack bot</h2>
				</section>
				<section>
					<h3>Code - the upper-bot</h3>
	<pre><code data-trim data-noescape><span class="lesser">const app = require('<span class="color2">express</span>')</span>

<span class="lesser">app.get('/', (req, res) => {</span>
  const { <span class="color4">text</span> = '' } = req.query
  const <span class="color1">uppercase</span> = <span class="color4">text</span>.toUpperCase()
  res.send('Your uppercase text is ' + <span class="color1">uppercase</span>)
<span class="lesser">})</span>

<span class="lesser">app.listen(process.env.PORT)</span></code></pre>
					<img src="images/slackbot_code.png" style="border: none; background: transparent; box-shadow: none; display: none;" />
				</section>
				<section>
					<h3>Deploy</h3>
					<!-- <div style="height: 450px"> -->
						<!-- <img src="images/up_code.png" style="border: none; background: transparent; box-shadow: none;" /> -->
					<!-- </div> -->
					<pre><code data-trim data-noescape>
$ <span class="fragment">up</span>

<div class="fragment" style="color: #aaa;">build: 175 files, 7.4 MB (<span class="color4">662ms</span>)
deploy: staging (commit c6f180c) (<span class="color4">25.522s</span>)
stack: complete (<span class="color4">14.198s</span>)
endpoint: <span class="color1">https://2ab05.execute-api.us-east-1.amazonaws.com/staging/</span></div>
</code></pre>
				</section>
	
				<section>
					<h3>Test</h3>
	<pre><code data-trim data-noescape>$ <span class="fragment"><span class="lesser">curl https://...amazonaws.com/</span>?text=<span class="color1">command-line-test</span></span>
	<div class="fragment">Your uppercase text is <span class="color1">COMMAND-LINE-TEST</span></div>
	</code></pre>
				</section>

				<section>
					<h3>Configure Slack</h3>
					<div style="height: 450px">
						<p><img src="images/slack_config.png" style="border: none" /></p>
					</div>
				</section>
				<section>
					<h3>Result</h3>
					<p><img src="images/slackbot.gif" style="border: none; width: 100%;" /></p>
				</section>

				<section>
					<h1>What just happened?</h1>
				</section>

				<section>
					<h3>up</h3>
					<img src='images/up.png' style="border: none; background: transparent; max-width: 80%;" />
				</section>

				<section>
					<h2>What did we get?</h2>
					<ol>
						<li><span class="color4">Highly available</span> Slack bot</li>
						<li>Scales from 0 to Infinity</li>
						<li>Pay per use</li>
						<li>No server management</li>
						<li class="fragment">Awesome <span class="color2">Developer Experience</span>!</li>
					</ol>
				</section>

<!-- 				<section>
					<h1>üëè</h1>
					<h1>Pause for applause</h1>
				</section>
 -->
<!-- 				<section>
					<h2>What is Serverless?</h2>
					<p>Serverless allows us to build and run applications and services <span class="color1">without thinking about servers</span></p>
				</section>
 -->
				<section>
					<h1>üÜí</h1>
					<h3>but can <span class="color4">serverless</span> be used for ‚Äú<span class="color4">real</span>‚Äù work ?</h3>
				</section>

				<section>
					<h2>Will <span class="color4">serverless</span> work for our startup?</h2>
				</section>

				<section>
					<h2>Why choose serverless?</h2>
					<p class="fragment">Minimum ops</p>
					<p class="fragment">Focus on <u><span class="color4">delivering more value</span></u></p>
					<p class="fragment">Advantage over competition</p>
					<p class="fragment">Win</p>
  				<p class="fragment">... while <span class="color2">sleeping better</span> at night</p>
				</section>

				<section>
					<h2>Serverless @ Torii</h2>
					<p>API Server(s)</p>
					<p>Background jobs</p>
					<p>Static content</p>
				</section>

				<section>
					<h1>üë®‚Äçüè´</h1>
					<h1>LESSONS LEARNED</h1>
				</section>

				<section>
					<h3>Best Practices Out-Of-The-üì¶</h3>
					<ol>
						<li class="fragment">Immutability</li>
						<li class="fragment">Versioning</li>
						<li class="fragment">Aliases</li>
						<li class="fragment">Zero downtime deployments</li>
						<li class="fragment">Instant Rollbacks</li>
					</ol>
				</section>

				<section>
					<h3>Infrastructure-as-Code</h3>
					<p>Friendly tools, even I can do it...</p>
					<!-- <img src="images/serverless.yml.png" style="border: none; background: white; border-radius: 5px" /> -->
					<pre class="fragment"><code data-trim data-noescape>
service: <span class="color1">scheduled-cron-example</span>

functions:
  cron:
    handler: <span class="color4">index.handler</span>
    events:
      # Invoke Lambda function every minute
      - schedule: <span class="color3">rate(1 minute)</span></code></pre>
				</section>

<!-- 				<section>
					<h3><span class="color4">Effortless</span> Scaling</h3>
					<p>Story time:<br/>‚ÄúThe day we served x1000 requests‚Äù</p>
				</section>
 -->
				<section>
					<h3>Better <span class="color1">Security</span></h3>
					<p class="fragment">Automatic OS and runtime security patches</p>
					<p class="fragment">Permissions per function</p>
					<p class="fragment"><del>SSH</del> is dead, less attack vectors</p>
					<p class="fragment">Easier certification<br/>
						<img src='images/soc2.png' style="border: none; background: transparent;" width="150"/>
					</p>
				</section>

<!-- 				<section>
					<h3>Pushing to the limits</h3>
					<p>Can all use cases be solved with serverless?</p>
					<p class="fragment">So far, so good</p>
					<ul>
						<li class="fragment">Headless Chrome</li>
						<li class="fragment">Long data processing</li>
						<li class="fragment">Full API server</li>
					</ul>
				</section>
 -->

 				<section>
					<h3>Limits</h3>
					<p><span class="fragment">15 minute max run time.</span> <span class="color4 fragment">Recursive invocations.</span></p>
					<p><span class="fragment">30 sec max API Gateway responses.</span> <span class="color4 fragment">Decoupled invocation.</span></p>
					<p><span class="fragment">No persistent servers, websockets, polling.</span> <span class="color4 fragment">There's a service for that.</span></p>
				</section>

				<section>
					<h3>Performance - Cold starts</h3>
					<img class="fragment" src="images/coldstarts.png" style="max-width: 80%;" />
				</section>

<!-- 				<section>
					<h3>Performance - Bundling</h3>
					<img src="images/node_modules.png" style="max-width: 60%;" />
				</section>
 -->
				<section>
					<h3>Optimizing Functions</h3>
					<p>A <span class="color1">lambda</span> function is <span class="color4">similar to a website</span></p>
					<ul>
						<li class="fragment">Bundle using Webpack</li>
						<li class="fragment">Remove useless files</li>
						<li class="fragment">Bundle + Remove</li>
						<li class="fragment">Lazy load code</li>
						<li class="fragment">Open source:<br> <a href="https://github.com/zeit/ncc">ncc</a>, <a href="https://github.com/zeit/pkg">pkg</a>, <a href="https://github.com/toriihq/lambdapack">lambdapack</a></li>
					</ul>
				</section>

				<section>
					<h3>Performance - Latency</h3>
					<img class="fragment" src="images/trip.jpg" />
				</section>

				<section>
					<h3>Scaling</h3>
					<p>Functions can scale, can the rest keep up?</p>
					<p class="fragment"><span class="color3">Limit concurrency</span></p>
				</section>

				<section>
					<h3>One Function vs. Many</h3>
					<p class="fragment"><span class="color2">Many small functions</span> or just <span class="color4">a large one</span>?</p>
					<p class="fragment">API servers are better as <span class="color4">one large function</span></p>
					<p class="fragment">Less <span class="color4">cold starts</span>, easier to <span class="color4">deploy</span> and <span class="color4">test</span></p>
				</section>

				<section>
					<h3>Secrets</h3>
					<p class="fragment">AWS Systems Manager Parameter Store (SSM)</p>
					<p><span class="fragment">Decrypt at runtime.</span> <span class="fragment color3">Doesn't scale well.</span></p>
					<p class="fragment">Bake it during deployment</p>
				</section>

				<section>
					<h3>Logging</h3>
					<p>Loggers were intended for always running servers</p>
					<p class="fragment">Who ‚ù§Ô∏è CloudWatch?</p>
					<p class="fragment">Lambda üëâ CloudWatch üëâ Lambda üëâ Papertrail</p>
				</section>

				<section>
					<h3>Actively Improving</h3>
					<p><span class="color1">We're just at the beginning</span></p>
					<p class="fragment">Cloud providers are investing a lot in serverless</p>
					<p class="fragment">Since most infra is on AWS, it keeps improving</p>
					<ul class="fragment">
						<li>30 seconds üëâ 5 mins üëâ 15 mins</li>
						<li>Node v6 üëâ Node v8 üëâ any version</li>
						<li>Faster VPN cold starts</li>
						<li>Websockets, SQS, ALB support</li>
					</ul>
				</section>

				<section>
					<h2>Is <span class="color4">serverless</span> the future?</h2>
					<h3 class="fragment">No. It's the <span class="color1">present</span>.</h3>
				</section>

				<section>
					<h3>Tal Bereznitskey</h3>
					<ul>
						<li><strong>Works</strong>: Co-Founder and CTO at <a href="https://toriihq.com">Torii</a></li>
						<li><strong>Codes</strong>: <a href="https://github.com/berzniz">github.com/berzniz</a></li>
						<li><strong>Tweets</strong>: <a href="https://twitter.com/ketacode">@ketacode</a></li>
						<li><strong>Writes</strong>: <br><a href="https://medium.com/ketacode">medium.com/ketacode</a><br><a href="ketacode.com">ketacode.com</a><br><a href="http://berzniz.com">berzniz.com</a></li>
					</ul>
				</section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			Reveal.initialize({
				history: true,
				width: 1280,
				height: 720,
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					// { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
